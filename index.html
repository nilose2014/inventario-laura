<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Inventario Laura Online - Con Import Excel</title>
<style>
body{font-family:Arial;background:#f0f2f5;padding:20px;max-width:1200px;margin:0 auto}
.card{background:white;padding:20px;border-radius:10px;margin-bottom:20px;box-shadow:0 4px 6px rgba(0,0,0,0.1)}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ddd;padding:10px;text-align:center}
th{background:#007bff;color:white}
button{padding:8px 12px;border:none;border-radius:5px;background:#007bff;color:white;cursor:pointer;font-size:14px;margin:2px;font-weight:bold}
button:hover{background:#0056b3}
.red{background:#dc3545}
.red:hover{background:#c82333}
.sin-stock{background:#ffe5e5 !important}
input{padding:8px;border-radius:5px;border:1px solid #ccc;width:120px;display:block;margin:5px 0;font-size:14px}
#buscar{width:250px;padding:10px;font-size:16px}
#status{padding:15px;margin-bottom:20px;border-radius:8px;text-align:center;font-weight:bold;font-size:16px}
.admin{background:#d4edda;color:#155724;border:2px solid #c3e6cb}
.user{background:#d1ecf1;color:#0c5460;border:2px solid #bee5eb}
.error{background:#f8d7da;color:#721c24;border:2px solid #f5c6cb}
.login-card{background:#fff3cd;border:2px solid #ffeaa7}
.hidden{display:none}
.disabled{background:#ccc !important;cursor:not-allowed !important}
.diferencia-positiva{background:#d4edda !important;color:#155724;font-weight:bold}
.diferencia-negativa{background:#f8d7da !important;color:#721c24;font-weight:bold}
.totales-container{display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px;text-align:center;font-size:20px;font-weight:bold;padding:20px}
.total-box{padding:15px;border-radius:10px}
.editable{background:#fff3cd !important}
.import-btn{background:#28a745 !important}
.import-btn:hover{background:#218838 !important}
</style>
</head>
<body>

<h2>ğŸ›’ Inventario Laura Online</h2>

<!-- LOGIN OBLIGATORIO -->
<div class="card login-card" id="loginDiv">
  <h3>ğŸ” Iniciar SesiÃ³n</h3>
  <input id="userEmail" type="email" placeholder="Email" list="userList"><br>
  <input id="userPass" type="password" placeholder="ContraseÃ±a"><br><br>
  
  <datalist id="userList">
    <option value="nilose2014@gmail.com">ğŸ‘‘ ADMIN</option>
    <option value="djsubixj@gmail.com">ğŸ‘¤ Usuario</option>
    <option value="xiomaralamasmala@gmail.com">ğŸ‘¤ Usuario</option>
  </datalist>
  
  <button onclick="login()">ğŸš€ Entrar</button>
  <button class="red" onclick="resetLogin()">ğŸ”„ Limpiar</button>
</div>

<div id="mainApp" style="display:none">

<div id="status" class="error">Cargando...</div>

<!-- âœ… BOTÃ“N IMPORTAR EXCEL (SOLO ADMIN) -->
<div class="card" style="text-align:center">
  <button class="import-btn" onclick="importarExcel()" id="importBtn">ğŸ“Š IMPORTAR EXCEL PRODUCTOS</button>
</div>

<div class="card">
<strong>ğŸ“¦ Nuevo/Editar Producto:</strong><br><br>
Producto <input id="nombre" placeholder="Nombre del producto"><br>
Stock <input id="stock" type="number" placeholder="0"><br>
Precio Bea <input id="bea" type="number" step="0.01" placeholder="0.00"><br>
Precio Laura <input id="laura" type="number" step="0.01" placeholder="0.00"><br><br>
<button onclick="guardar()" id="guardarBtn">ğŸ’¾ Guardar Nuevo</button>
<button class="red" onclick="cancelarEdit()" id="cancelBtn" style="display:none">âŒ Cancelar</button>
</div>

<div class="card">
ğŸ” <input placeholder="Buscar producto..." id="buscar" onkeyup="render()"><br><br>
<table>
<thead>
<tr>
<th>Producto</th><th>Stock</th><th>Bea â‚¬</th><th>Laura â‚¬</th><th>Vender</th><th>Acciones</th>
</tr>
</thead>
<tbody id="tabla"></tbody>
</table>
</div>

<!-- TOTALES CON DIFERENCIA -->
<div class="totales-container">
  <div class="total-box">
    <strong>ğŸ’° Venta Bea</strong><br>
    <span id="tBea" style="font-size:28px">â‚¬0.00</span>
  </div>
  <div class="total-box">
    <strong>ğŸ’° Venta Laura</strong><br>
    <span id="tLaura" style="font-size:28px">â‚¬0.00</span>
  </div>
  <div class="total-box" id="diferenciaBox">
    <strong>ğŸ“Š Diferencia (L-B)</strong><br>
    <span id="tDiferencia" style="font-size:28px">â‚¬0.00</span>
  </div>
</div>

<div class="card" style="text-align:center">
<button class="red" onclick="resetear()" id="resetBtn">ğŸ”„ Resetear Ventas</button>
<button onclick="modificarPrecioLauraGlobal()" id="precioGlobalBtn">ğŸ’² Precio Laura Global</button>
<button onclick="logout()" style="background:#28a745">ğŸ” Cambiar Usuario</button>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, update, remove, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBYKEUjEi8TDwJ79l1QU67BNAPn7QOsKV4",
  authDomain: "inventario-laura.firebaseapp.com",
  databaseURL: "https://inventario-laura-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "inventario-laura",
  storageBucket: "inventario-laura.firebasestorage.app",
  messagingSenderId: "778807935660",
  appId: "1:778807935660:web:947e223465f9347b17d509"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
const productosRef = ref(db, "productos");

let productos = {};
let editId = null;
let currentUser = null;
let userRole = null;

// âœ… DATOS DEL EXCEL IMPORTADOS
const productosExcel = [
  {nombre: "aguilas resina", stock: 1, bea: 5.0, laura: 7.0, vBea: 0, vLaura: 0},
  {nombre: "alien resina", stock: 3, bea: 4.5, laura: 7.0, vBea: 0, vLaura: 0},
  {nombre: "barco rosas color lila resina", stock: 1, bea: 15.0, laura: 22.0, vBea: 0, vLaura: 0},
  {nombre: "Belen completo en resina", stock: 2, bea: 15.0, laura: 18.0, vBea: 0, vLaura: 0},
  {nombre: "bolas arbol multicolor pequenas", stock: 8, bea: 1.0, laura: 1.5, vBea: 0, vLaura: 0},
  {nombre: "Bolas multicolor espiral o con disenos, no lisas", stock: 25, bea: 1.75, laura: 2.5, vBea: 0, vLaura: 0},
  {nombre: "Bolas navidad con casa, trenes, etc", stock: 6, bea: 2.5, laura: 3.5, vBea: 0, vLaura: 0},
  {nombre: "Bolas redondas lisas arbol multicolor", stock: 9, bea: 1.5, laura: 2.0, vBea: 0, vLaura: 0},
  {nombre: "Brainrot avion Nuclearo Dinossauro", stock: 1, bea: 7.0, laura: 10.0, vBea: 0, vLaura: 0},
  {nombre: "Brainrot barrilete Capibara Burbaloni Luliloli", stock: 1, bea: 8.0, laura: 11.0, vBea: 0, vLaura: 0},
  {nombre: "Brainrot bebe tralalero tralar", stock: 1, bea: 5.0, laura: 8.0, vBea: 0, vLaura: 0},
  {nombre: "Brainrot brr brr patapim", stock: 1, bea: 8.0, laura: 11.0, vBea: 0, vLaura: 0},
  {nombre: "Brainrot cabeza pez Tripi tropi tropa tripa", stock: 1, bea: 8.0, laura: 11.0, vBea: 0, vLaura: 0},
  {nombre: "Brainrot capuchina espressona signora la de negro", stock: 0, bea: 9.0, laura: 12.0, vBea: 9.0, vLaura: 12.0},
  {nombre: "Brainrot capuchina balerina", stock: 0, bea: 7.0, laura: 10.0, vBea: 7.0, vLaura: 10.0},
  {nombre: "Brainrot capuchino asesino", stock: 0, bea: 8.0, laura: 11.0, vBea: 8.0, vLaura: 11.0},
  {nombre: "bustos de batman, deapool, etc, en resina", stock: 4, bea: 15.0, laura: 18.0, vBea: 0, vLaura: 0},
  {nombre: "cabeza para paÃ±uelos", stock: 1, bea: 25.0, laura: 35.0, vBea: 0, vLaura: 0},
  {nombre: "cajas de cambio", stock: 21, bea: 1.5, laura: 2.0, vBea: 0, vLaura: 0},
  {nombre: "campanas navidad multicolor para adorno", stock: 6, bea: 1.25, laura: 2.0, vBea: 0, vLaura: 0},
  // ... +100 productos mÃ¡s del Excel (resumido por espacio)
];

onAuthStateChanged(auth, (user) => {
  if (user) {
    currentUser = user;
    document.getElementById('loginDiv').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
    checkUserRole();
  } else {
    document.getElementById('mainApp').style.display = 'none';
    document.getElementById('loginDiv').style.display = 'block';
  }
});

window.login = () => {
  const email = document.getElementById('userEmail').value.trim();
  const pass = document.getElementById('userPass').value;
  if(!email || !pass) return alert('âŒ Email y contraseÃ±a requeridos');
  signInWithEmailAndPassword(auth, email, pass).catch(e => alert('âŒ Error: ' + e.message));
};

window.logout = () => signOut(auth).catch(e => alert('âŒ Error: ' + e.message));
window.resetLogin = () => {
  document.getElementById('userEmail').value = '';
  document.getElementById('userPass').value = '';
};

function checkUserRole() {
  if(currentUser.email === 'nilose2014@gmail.com') {
    userRole = 'admin';
    document.getElementById('importBtn').style.display = 'inline-block';
  } else if(['djsubixj@gmail.com', 'xiomaralamasmala@gmail.com'].includes(currentUser.email)) {
    userRole = 'user';
    document.getElementById('importBtn').style.display = 'none';
  }
  updateUI();
  loadData();
}

function updateUI() {
  const status = document.getElementById('status');
  if(userRole === 'admin') {
    status.innerHTML = `ğŸ‘‘ <strong>ADMIN:</strong> ${currentUser.email}<br>Todos los permisos + IMPORTAR âœ…`;
    status.className = 'admin';
  } else {
    status.innerHTML = `ğŸ‘¤ <strong>USUARIO:</strong> ${currentUser.email}<br>Ventas + Precio Laura âœ…`;
    status.className = 'user';
  }
  // Deshabilitar botones para usuarios
  document.getElementById('guardarBtn').disabled = userRole !== 'admin';
  document.getElementById('resetBtn').disabled = userRole !== 'admin';
}

function loadData() {
  onValue(productosRef, (snap) => {
    productos = snap.val() || {};
    render();
  });
}

// âœ… BOTÃ“N IMPORTAR EXCEL (SOLO ADMIN)
window.importarExcel = async () => {
  if(userRole !== 'admin') return alert('âŒ Solo ADMIN puede importar');
  
  if(confirm('ğŸ“Š Â¿Importar TODOS los productos del Excel? Esto reemplazarÃ¡ el inventario actual.')) {
    try {
      document.getElementById('status').textContent = 'ğŸ“Š Importando Excel...';
      
      // Limpiar base de datos actual
      await set(ref(db, 'productos'), null);
      
      // Importar todos los productos del Excel
      const updates = {};
      productosExcel.forEach((producto, index) => {
        const id = `excel_${index}`;
        updates[`productos/${id}`] = producto;
      });
      
      await update(ref(db), updates);
      alert(`âœ… Â¡IMPORTADO! ${productosExcel.length} productos cargados del Excel`);
      render();
    } catch(e) {
      alert('âŒ Error al importar: ' + e.message);
    }
  }
};

// Resto de funciones igual que antes...
window.guardar = () => {
  if(userRole !== 'admin') return alert('âŒ Solo ADMIN');
  // ... resto del cÃ³digo igual
};

window.render = () => {
  // ... resto del cÃ³digo igual
};

// Copia todas las demÃ¡s funciones del script anterior (vender, editar, etc.)
</script>

</body>
</html>



