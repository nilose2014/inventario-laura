<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Inventario Laura Online</title>
<style>
body { font-family: Arial; background:#f0f2f5; padding:20px }
.card { background:white; padding:15px; border-radius:10px; margin-bottom:20px }
table { width:100%; border-collapse:collapse }
th,td { border:1px solid #ddd; padding:8px; text-align:center }
button { padding:6px 10px; border:none; border-radius:5px; background:#007bff; color:white }
.red { background:#dc3545 }
</style>
</head>
<body>

<h2>Inventario y Ventas</h2>

<div class="card">
Producto <input id="nombre">
Stock <input id="stock" type="number">
Precio Bea <input id="bea" type="number">
Precio Laura <input id="laura" type="number">
<button onclick="guardar()">Guardar</button>
</div>

<div class="card">
<table>
<thead>
<tr>
<th>Producto</th><th>Stock</th><th>Bea</th><th>Laura</th><th>Vender</th>
</tr>
</thead>
<tbody id="tabla"></tbody>
</table>
</div>

<div class="card">
Venta Bea: €<span id="tBea">0</span><br>
Venta Laura: €<span id="tLaura">0</span><br>
<button class="red" onclick="resetear()">Resetear ventas</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue, update } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBYKEUjEi8TDwJ79l1QU67BNAPn7QOsKV4",
  authDomain: "inventario-laura.firebaseapp.com",
  databaseURL: "https://inventario-laura-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "inventario-laura",
  storageBucket: "inventario-laura.firebasestorage.app",
  messagingSenderId: "778807935660",
  appId: "1:778807935660:web:947e223465f9347b17d509"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const productosRef = ref(db, "productos");

let productos = {};
let totalBea = 0;
let totalLaura = 0;

onValue(productosRef, snap => {
  productos = snap.val() || {};
  totalBea = 0;
  totalLaura = 0;
  document.getElementById("tabla").innerHTML = "";
  Object.entries(productos).forEach(([id,p])=>{
    totalBea += p.vBea || 0;
    totalLaura += p.vLaura || 0;
    document.getElementById("tabla").innerHTML += `
    <tr>
      <td>${p.nombre}</td>
      <td>${p.stock}</td>
      <td>${p.bea}</td>
      <td>${p.laura}</td>
      <td>
        <button onclick="vender('${id}')">Vender</button>
      </td>
    </tr>`;
  });
  document.getElementById("tBea").innerText = totalBea;
  document.getElementById("tLaura").innerText = totalLaura;
});

window.guardar = () => {
  push(productosRef, {
    nombre: nombre.value,
    stock: Number(stock.value)||0,
    bea: Number(bea.value)||0,
    laura: Number(laura.value)||0,
    vBea:0,
    vLaura:0
  });
};

window.vender = id => {
  const p = productos[id];
  if(p.stock<=0) return alert("Sin stock");
  update(ref(db,"productos/"+id),{
    stock:p.stock-1,
    vBea:p.vBea + p.bea,
    vLaura:p.vLaura + p.laura
  });
};

window.resetear = ()=>{
  Object.entries(productos).forEach(([id])=>{
    update(ref(db,"productos/"+id),{vBea:0,vLaura:0});
  });
};
</script>

</body>
</html>

